<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Mapbox</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        html, body { margin: 0; padding: 0; width: 100%; height: 100%; }
        #map { height: 100%; width: 100%; }
    </style>


    <script src='https://api.mapbox.com/mapbox-gl-js/v1.9.1/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v1.9.1/mapbox-gl.css' rel='stylesheet' />
    <script
            src="https://code.jquery.com/jquery-3.4.1.min.js"
            integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
            crossorigin="anonymous"></script>

</head>
<body>

<div id="map"></div>

<script>
    const p1 = [43.7524, 3.9077, 43.7754, 3.9301];
    const p2 = [43.7535, 3.8865, 43.7744, 3.9069];

    mapboxgl.accessToken = 'pk.eyJ1IjoiZG9lbGlhIiwiYSI6ImNqN3JydGhiZDN6cHEzM251dXVsZ3FodjQifQ.mtRIEu7WPakLBYQRVgV52g';
    var map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v9',
        center: [3.9060693, 43.766189],
        zoom: 14,
    });

    map.on('load', () => {
        map.addSource('source_suque', {
            type: 'image',
            url: 'https://stephane-tests.s3.eu-west-3.amazonaws.com/maps/suque_icons.png',
            coordinates: [
                [p1[1], p1[2]],
                [p1[3], p1[2]],
                [p1[3], p1[0]],
                [p1[1], p1[0]]
            ]
        });
        map.addLayer({
            "id": "overlay_suque",
            "source": "source_suque",
            "type": "raster",
        })
        
        map.addSource('source_ceceles', {
            type: 'image',
            url: 'https://stephane-tests.s3.eu-west-3.amazonaws.com/maps/ceceles_icons.png',
            coordinates: [
                [p2[1], p2[2]],
                [p2[3], p2[2]],
                [p2[3], p2[0]],
                [p2[1], p2[0]]
            ]
        });
        map.addLayer({
            "id": "overlay_ceceles",
            "source": "source_ceceles",
            "type": "raster",
        })

        map.addControl(
            new mapboxgl.GeolocateControl({
                positionOptions: {
                    enableHighAccuracy: true
                },
                trackUserLocation: true
            })
        );

        $(function() {
            $.ajax({
                dataType: "json",
                url: "points.geojson",
                success: function (geojson) {
                    map.addSource('points', {
                        'type': 'geojson',
                        'data': geojson
                    });

                    map.addLayer({
                        'id': 'points',
                        'type': 'circle',
                        'source': 'points',
                        'paint': {
                            'circle-radius': {
                                'base': 1.75,
                                'stops': [[12, 2], [22, 180]]
                            },
                            'circle-color': 'White'
                        }
                        // 'layout': {
                        //     'icon-image': ['concat', ['get', 'icon'], '-15'],
                        //     'text-field': ['get', 'title'],
                        //     'text-font': ['Open Sans Semibold', 'Arial Unicode MS Bold'],
                        //     'text-offset': [0, 0.6],
                        //     'text-anchor': 'top'
                        // }
                    });

                }
            })
        })
    })

</script>

</body>
</html>
